import{b as g,N as w,ad as N,r as j,m as C,ae as L,j as t,S as p,af as b,ag as U,ah as v,ai as B,aj as M,ak as y,al as k,am as F,an as G,T as Q}from"./index-Du6cLc2g.js";import{u as H}from"./index.esm-ByZbOMQw.js";import{B as m}from"./ButtonLink-rFd5ZjYd.js";import{T as $}from"./TypographyLink-Dt5Yliyh.js";import{P as T}from"./adornments-CbGr532U.js";import{C as K,D as V}from"./DialogHeader-Cbmle0D8.js";import{I as q}from"./InvalidTokenScreen-DWEJ6U3t.js";import{t as u}from"./toDate-BXq0HhWu.js";import{T as h}from"./TextField-HOePLdCm.js";import{i as O}from"./password-DGq-f_5N.js";import{F as J}from"./FormControlLabel-Ck-LB9EX.js";import{C as X}from"./Checkbox-zg_kSEbu.js";import{A as D}from"./Alert-CbKF_a_e.js";import{B as z}from"./Button-BZonE8EM.js";import"./InputAdornment-19J4ELs1.js";import"./FormControl-BpWV3VDf.js";import"./isMuiElement-BOwKGjxf.js";import"./lock-D7BFDH4B.js";import"./mail-UxXkPhko.js";import"./styles-ClJhet3s.js";import"./Box-6qYIb0IB.js";import"./AlertTitle-Bdf1oZJW.js";import"./LanguageSwitch-DF2Cbktt.js";import"./langs-DUiJXdIq.js";import"./normalizeDates-Bl5IZJGD.js";import"./Menu-BWxVMNIi.js";import"./useSlot-Jtq-mfHw.js";import"./ButtonBase-CdsCMxD3.js";import"./isFocusVisible-B8k4qzLc.js";import"./Grow-DtN_YV5L.js";import"./utils-TS7gOHXB.js";import"./Modal-CVujTFOw.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Popover-DKSgKXB-.js";import"./Paper-B8YcVVca.js";import"./List-BxElNHcx.js";import"./listItemTextClasses-D6I-qz9g.js";import"./MenuItem-BDQospWL.js";import"./dividerClasses-bGF6_inT.js";import"./IconButton-DGQNRfUk.js";import"./CircularProgress-CnPELIce.js";import"./chevron-down-DS52ak5B.js";import"./useControlled-B5xzdI43.js";import"./createSvgIcon-DpKUgtm0.js";import"./utils-CHXX7DhN.js";import"./SwitchBase-DRi_6CGV.js";function Y(r,e){return+u(r)>+u(e)}class S extends Error{}S.prototype.name="InvalidTokenError";function Z(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,o)=>{let s=o.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}function rr(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Z(e)}catch{return atob(e)}}function tr(r,e){if(typeof r!="string")throw new S("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,s=r.split(".")[o];if(typeof s!="string")throw new S(`Invalid token specified: missing part #${o+1}`);let a;try{a=rr(s)}catch(n){throw new S(`Invalid token specified: invalid base64 for part #${o+1} (${n.message})`)}try{return JSON.parse(a)}catch(n){throw new S(`Invalid token specified: invalid json for part #${o+1} (${n.message})`)}}const er=r=>{if(r)try{const{exp:e}=tr(r);if(e){const o=e*1e3;if(Y(o,Date.now()))return{isValid:!0,token:r}}}catch{console.error("Token is not a JWT.")}return{isValid:!1,token:null}};function Jr(){const{t:r}=g(w.Auth),e=N.useSearch(),{isValid:o,token:s}=er(e.t),[a,n]=j.useState(!1),{register:R,handleSubmit:A,formState:{errors:c}}=H(),{mutate:f,isPending:I,isError:E,isSuccess:d}=C(L());if(!o)return t.jsx(q,{});const P=({password:i})=>{f({body:{password:i},headers:{authorization:`Bearer ${s}`}})},_=c.password?.message,l=c.confirmPassword?.message,W=!!(_||l);return t.jsxs(K,{header:t.jsx(V,{title:r("RESET_PASSWORD_TITLE"),description:t.jsxs(p,{gap:1,width:"100%",children:[r("RESET_PASSWORD_DESCRIPTION"),t.jsxs(Q,{children:[r("RESET_PASSWORD_REQUIREMENTS_TITLE"),t.jsxs("ul",{style:{margin:0},children:[t.jsx("li",{children:r("RESET_PASSWORD_REQUIREMENTS_LENGTH",{length:8})}),t.jsx("li",{children:r("RESET_PASSWORD_REQUIREMENTS_LOWERCASE",{count:1})}),t.jsx("li",{children:r("RESET_PASSWORD_REQUIREMENTS_UPPERCASE",{count:1})}),t.jsx("li",{children:r("RESET_PASSWORD_REQUIREMENTS_NUMBER",{count:1})})]})]})]})}),children:[t.jsxs(p,{component:"form",onSubmit:A(P),direction:"column",alignItems:"center",spacing:1,width:"100%",children:[t.jsx(h,{id:U,slotProps:{input:{startAdornment:T},formHelperText:{id:b}},...R("password",{required:r("REQUIRED_FIELD_ERROR"),validate:i=>O(i)||r("PASSWORD_WEAK_ERROR")}),label:r("RESET_PASSWORD_NEW_PASSWORD_FIELD_LABEL"),variant:"outlined",error:!!_,helperText:_,type:a?"":"password",fullWidth:!0,disabled:d||E}),t.jsx(h,{id:B,slotProps:{input:{startAdornment:T},formHelperText:{id:v}},...R("confirmPassword",{required:r("REQUIRED_FIELD_ERROR"),validate:{strong:i=>O(i)||r("PASSWORD_WEAK_ERROR"),match:(i,x)=>i===x.password||r("PASSWORD_DO_NOT_MATCH_ERROR")}}),label:r("RESET_PASSWORD_NEW_PASSWORD_CONFIRMATION_FIELD_LABEL"),variant:"outlined",error:!!l,helperText:l,type:a?"":"password",fullWidth:!0,disabled:d||E}),t.jsx(J,{sx:{width:"100%"},control:t.jsx(X,{value:a,onChange:()=>n(i=>!i)}),label:r("SHOW_PASSWORD")}),E&&t.jsxs(t.Fragment,{children:[t.jsx(D,{id:M,severity:"error",children:r("RESET_PASSWORD_ERROR_MESSAGE",{email:y})}),t.jsx(m,{variant:"contained",fullWidth:!0,to:"/auth/forgot-password",sx:{textDecoration:"none"},children:r("REQUEST_PASSWORD_RESET_TITLE")})]}),d?t.jsxs(t.Fragment,{children:[t.jsx(D,{id:k,severity:"success",children:r("RESET_PASSWORD_SUCCESS_MESSAGE")}),t.jsx(m,{variant:"contained",fullWidth:!0,to:"/auth/login",id:F,children:r("BACK_TO_SIGN_IN_BUTTON")})]}):t.jsx(z,{id:G,variant:"contained",loading:I,fullWidth:!0,type:"submit",disabled:W||E,children:r("RESET_PASSWORD_BUTTON")})]}),!d&&t.jsx($,{to:"/auth/login",color:"textSecondary",sx:{textDecoration:"none"},children:r("BACK_TO_SIGN_IN_BUTTON")})]})}export{Jr as component};
