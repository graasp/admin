import{I as D}from"./itemType-D9KQEJss.js";import{h as E,A as _,Z as f,r as a,h4 as i,cM as V,cN as G,i7 as N,c3 as O,e2 as w}from"./index-Du6cLc2g.js";import{a as c,I as U}from"./itemLogin-BRGmCLqv.js";var T;(function(e){e.Unpublished="unpublished",e.Published="published",e.PublishedChildren="publishedChildren",e.ReadyToPublish="readyToPublish",e.Pending="pending",e.Invalid="invalid",e.Outdated="outdated",e.ItemTypeNotAllowed="itemTypeNotAllowed"})(T||(T={}));class b{static isItemTypeAllowedToBePublished(t){return b.ALLOWED_PUBLISHING_TYPES.includes(t)}static getAllowedTypes(){return Array.from(b.ALLOWED_PUBLISHING_TYPES)}}Object.defineProperty(b,"ALLOWED_PUBLISHING_TYPES",{enumerable:!0,configurable:!0,writable:!0,value:[D.FOLDER]});function v(e){const{data:t,isLoading:o}=E.useItemMemberships(e),l=t?.filter(({account:{type:n}})=>n===_.Guest);return{isLoading:o,data:l}}const{useItemLoginSchema:R,useItemPublishedInformation:k}=E,{useDeleteItemVisibility:C,usePostItemVisibility:H,useUnpublishItem:x,usePutItemLoginSchema:W}=f,$=e=>{const{mutateAsync:t}=H(),{mutate:o}=C(),{mutate:l}=f.useDeleteItemLoginSchema(),{data:n,isLoading:S}=v(e.id),{data:u,isLoading:A}=k({itemId:e.id},{enabled:!!e.public}),{mutate:p}=x(),{data:s,isLoading:M}=R({itemId:e.id}),{mutate:I}=W(),[h,B]=a.useState(!1);a.useEffect(()=>{const m=s&&s?.status!==c.Disabled&&s?.item?.path!==e?.path,d=e?.public&&e?.public?.itemPath!==e?.path;B(!!(m||d))},[s,e]);const L=A||M||S,[y,r]=a.useState(i.ITEM_PRIVATE.name);a.useEffect(()=>{switch(!0){case!!e.public:{r(i.ITEM_PUBLIC.name);break}case!!(s?.id&&s.status!==c.Disabled):{r(i.ITEM_LOGIN.name);break}default:r(i.ITEM_PRIVATE.name)}},[u,e,s]);const g=a.useMemo(()=>async m=>{const d=()=>{u&&p({id:e.id}),e.public&&o({itemId:e.id,type:"public"})},P=()=>{s&&n&&(n.length?I({itemId:e.id,status:c.Disabled}):l({itemId:e.id}))};switch(m){case i.ITEM_PRIVATE.name:{d(),P();break}case i.ITEM_LOGIN.name:{d(),I({itemId:e.id,type:U.Username,status:c.Active});break}case i.ITEM_PUBLIC.name:{await t({itemId:e.id,type:"public"}),P();break}}},[u,e.public,e.id,p,o,s,n,I,l,t]);return a.useMemo(()=>({isLoading:L,isDisabled:h,itemPublishEntry:u,itemLoginSchema:s,publicVisibility:e.public,visibility:y,updateVisibility:g}),[L,h,u,s,e.public,y,g])},Y=async e=>V.get(`${G}/${N(e)}`).then(({data:t})=>t),j=e=>O({queryKey:w.single(e).publicationStatus,queryFn:()=>Y(e),enabled:!!e});export{T as P,j as a,$ as b,b as c,v as u};
