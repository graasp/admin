import{b as m,N as l,a6 as k,m as P,ap as B,j as e,S as s,aq as H,ar as w,as as I,at as S,au as V,av as X,T as c,aw as q,L as R,ax as z,ay as f,az as K}from"./index-Du6cLc2g.js";import{u as Q}from"./invitation-Dw3enmoE.js";import{L as W}from"./LeftContentContainer-nC9pbiS8.js";import{u as J,a as N}from"./index.esm-ByZbOMQw.js";import{u as Y}from"./useLocation-yoai5t4G.js";import{T as Z}from"./TypographyLink-Dt5Yliyh.js";import{e as $,R as ee}from"./RecaptchaContext-xrzY-iXs.js";import{A as j}from"./styles-ClJhet3s.js";import{F as re,S as T,E as te}from"./StyledTextField-z_dx5nUi.js";import{N as oe,E as ae}from"./adornments-CbGr532U.js";import{M as ie}from"./constants-w-S_fMru.js";import{i as ne}from"./isEmail-CP0_oc0v.js";import{B as se}from"./Button-BZonE8EM.js";import{F as L}from"./FormControlLabel-Ck-LB9EX.js";import{T as v}from"./Trans-EtLtbqsJ.js";import{C}from"./Checkbox-zg_kSEbu.js";import{A as me}from"./Alert-CbKF_a_e.js";import"./AnalyticsIcon-BTh_u3pF.js";import"./LibraryIcon-Ce6_jpZ3.js";import"./PlayIcon-Dio1sQ0L.js";import"./Box-6qYIb0IB.js";import"./AlertTitle-Bdf1oZJW.js";import"./LanguageSwitch-DF2Cbktt.js";import"./langs-DUiJXdIq.js";import"./normalizeDates-Bl5IZJGD.js";import"./toDate-BXq0HhWu.js";import"./Menu-BWxVMNIi.js";import"./useSlot-Jtq-mfHw.js";import"./ButtonBase-CdsCMxD3.js";import"./isFocusVisible-B8k4qzLc.js";import"./Grow-DtN_YV5L.js";import"./utils-TS7gOHXB.js";import"./Modal-CVujTFOw.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Popover-DKSgKXB-.js";import"./Paper-B8YcVVca.js";import"./List-BxElNHcx.js";import"./listItemTextClasses-D6I-qz9g.js";import"./MenuItem-BDQospWL.js";import"./dividerClasses-bGF6_inT.js";import"./IconButton-DGQNRfUk.js";import"./CircularProgress-CnPELIce.js";import"./chevron-down-DS52ak5B.js";import"./TextField-HOePLdCm.js";import"./FormControl-BpWV3VDf.js";import"./isMuiElement-BOwKGjxf.js";import"./useControlled-B5xzdI43.js";import"./createSvgIcon-DpKUgtm0.js";import"./InputAdornment-19J4ELs1.js";import"./lock-D7BFDH4B.js";import"./mail-UxXkPhko.js";import"./utils-CHXX7DhN.js";import"./SwitchBase-DRi_6CGV.js";function le({control:t}){const{field:a}=N({control:t,name:"enableSaveActions"}),{t:r}=m(l.Auth,{keyPrefix:"REGISTER"});return e.jsx(L,{control:e.jsx(C,{id:q,size:"small",checked:a.value,onChange:(n,o)=>a.onChange(o)}),label:e.jsx(c,{fontSize:"small",children:e.jsx(v,{i18nKey:"SAVE_ACTIONS_LABEL",t:r,components:{1:e.jsx("a",{href:"https://graasp.github.io/docs/user/account/data-collection",target:"_blank",children:"_"})}})})})}function ce({control:t}){const{t:a}=m(l.Auth),{field:r,formState:{errors:n}}=N({control:t,name:"userHasAcceptedAllTerms",rules:{required:a("USER_AGREEMENTS_REQUIRED")}}),o=n.userHasAcceptedAllTerms?.message;return e.jsxs(e.Fragment,{children:[e.jsx(L,{control:e.jsx(C,{checked:r.value,onChange:(d,p)=>r.onChange(p),color:o?"error":"primary","data-cy":z,size:"small"}),label:e.jsx(c,{display:"inline",fontSize:"small",color:o?"error":"default",children:e.jsx(v,{t:a,i18nKey:j.USER_AGREEMENTS_CHECKBOX_LABEL,components:{terms:e.jsx(R,{to:"/terms",target:"_blank",rel:"noreferrer"}),privacy:e.jsx(R,{to:"/policy",target:"_blank",rel:"noreferrer"})}})})}),o&&e.jsx(c,{variant:"caption",color:"error",children:o})]})}function u({search:t,initialData:a}){const{t:r,i18n:n}=m(l.Auth),{t:o}=m(l.Common,{keyPrefix:"FIELD_ERROR"}),d=k(),p=Y(),{register:_,handleSubmit:b,control:A,formState:{errors:E}}=J({defaultValues:{enableSaveActions:!0,...a}}),{mutateAsync:y,isPending:M,error:U}=P({...B(),onError:i=>{console.error(i)}}),G=async i=>{const g=i.email.toLowerCase(),F=i.name.trim(),O=await $(ee.SignUp);await y({query:{lang:n.language},body:{name:F,email:g,captcha:O,url:t.url,enableSaveActions:i.enableSaveActions}}),d({to:"/auth/success",search:{email:g,back:p.pathname}})},h=E.name?.message,x=E.email?.message,D=Object.keys(E).length>0;return e.jsxs(s,{direction:"column",gap:4,alignItems:"center",maxWidth:"300px",children:[e.jsx(re,{id:H,title:r(j.REGISTER_TITLE)}),e.jsxs(s,{component:"form",onSubmit:b(G),direction:"column",gap:1,children:[e.jsx(T,{id:w,variant:"outlined",slotProps:{input:{startAdornment:oe}},autoFocus:!0,helperText:h,error:!!h,..._("name",{required:o("REQUIRED"),maxLength:{value:S,message:o("USERNAME_MAX_LENGTH",{max:S})},minLength:{value:I,message:o("USERNAME_MIN_LENGTH",{min:I})},validate:i=>ie.USERNAME_FORMAT_REGEX.test(i.trim())||o("USERNAME_SPECIAL_CHARACTERS")}),placeholder:r("NAME_FIELD_LABEL")}),e.jsx(T,{id:V,slotProps:{input:{startAdornment:ae}},variant:"outlined",error:!!x,helperText:x,..._("email",{required:o("REQUIRED"),validate:i=>ne(i,{})||o("INVALID_EMAIL")}),placeholder:r("EMAIL_INPUT_PLACEHOLDER_REQUIRED"),disabled:!!a?.email}),e.jsxs(s,{children:[e.jsx(le,{control:A}),e.jsx(ce,{control:A})]}),e.jsx(te,{error:U}),e.jsx(se,{id:X,type:"submit",variant:"contained",loading:M,fullWidth:!0,disabled:D,children:r("SIGN_UP_BUTTON")})]}),e.jsx(Z,{color:"textSecondary",to:"/auth/login",search:t,children:r("SIGN_IN_LINK_TEXT")})]})}function pe(){const t=f.useSearch(),{t:a}=m(l.Auth),{data:r,isPending:n}=Q(t.invitationId);return r?e.jsx(u,{search:t,initialData:{name:r.name,email:r.email}}):n?e.jsxs(s,{direction:"column",spacing:1,children:[e.jsx(c,{children:a("INVITATION_LOADING_MESSAGE")}),e.jsx(K,{})]}):e.jsxs(s,{gap:2,alignItems:"center",children:[e.jsx(me,{severity:"warning",sx:{maxWidth:"35ch"},children:a("INVITATION_NOT_FOUND_MESSAGE")}),e.jsx(u,{search:t})]})}function Ee(){const t=f.useSearch();return t.invitationId?e.jsx(pe,{}):e.jsx(u,{search:t})}const Er=()=>e.jsx(W,{children:e.jsx(Ee,{})});export{Er as component};
