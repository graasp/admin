import{v as V,d as M,b as x,N as I,j as t,S as C,fU as Ee,fV as Ce,r as h,eL as Te,bE as be,s as y,aV as ie,dP as w,h as g,fW as _e,fX as je,C as ae,L as Ne,fY as Se,fZ as ye,f0 as X,f_ as we,f$ as ve,g0 as Le,i as le,aW as Oe,g1 as Re,g2 as Pe,g3 as ce,H as Ae,e as Q,g4 as Fe,g5 as De,cN as Be,g6 as Me,g7 as ke,g8 as He,g9 as Ue,bg as de,ga as $e,T as Ge,D as We,gb as Ve,gc as Xe,gd as qe,ge as ze,m as Ke,gf as Ze,Z as Ye,$ as Qe,gg as Je,b7 as et,gh as tt,A as nt}from"./index-Du6cLc2g.js";import{F as rt,I as st,R as ot,E as it}from"./RequestAccessContent-DYIbAgne.js";import{B as ue}from"./ButtonLink-rFd5ZjYd.js";import{B as pe}from"./Button-BZonE8EM.js";import{M as at}from"./MaintenanceAnnouncement-sOrv1EwO.js";import{u as me}from"./useMobileView-DsvLNutV.js";import{C as J,S as lt,P as ct,E as dt,H as ut,D as pt,F as mt,b as ht,a as ft,c as gt}from"./DrawerHeader-CUSxRhxU.js";import{S as xt,D as U}from"./constants-CyQbYbhY.js";import{A as It,r as Et}from"./AppItem-B9gZd0dB.js";import{b as Ct}from"./withResizing-9DMApuwO.js";import{T as Tt}from"./TextDisplay-D01g4AZQ.js";import{S as j}from"./Skeleton-DL17Y8WH.js";import{C as bt,a as _t}from"./LinkUrlField-Dv3sfJld.js";import{T as k}from"./Tooltip-CkGlpyEO.js";import{M as jt,E as Nt}from"./message-square-off-DuYNhUuB.js";import{M as St,a as yt,P as wt}from"./pin-BudRUfMl.js";import{P as he}from"./permissionLevel-BOsSKewz.js";import{b as vt,c as Lt}from"./itemGeolocation-BH8Ul2eO.js";import{s as Ot,c as Rt}from"./shuffle-_LX9pwJ9.js";import{C as $}from"./chevron-right-BsjSU9To.js";import{B as q}from"./Box-6qYIb0IB.js";import{T as Pt}from"./Thumbnail--Tilnabo.js";import{I as At}from"./ItemIcon-CVFe5RC4.js";import{C as Ft}from"./Card-CdGogg3Y.js";import{C as Dt}from"./CardActionArea-DIOO8dgr.js";import{D as Bt}from"./door-open-DV7dVqPj.js";import{A as O}from"./triggers-BfmRfMmW.js";import{A as N}from"./Alert-CbKF_a_e.js";import{D as fe}from"./Divider-CoTlx057.js";import{A as Mt}from"./AlertTitle-Bdf1oZJW.js";import{T as kt,D as Ht}from"./Avatar-BogaTqsp.js";import{I as Ut}from"./IconButton-DGQNRfUk.js";import"./Button-D6pY2JNh.js";import"./itemLogin-BRGmCLqv.js";import"./TextField-HOePLdCm.js";import"./useSlot-Jtq-mfHw.js";import"./ButtonBase-CdsCMxD3.js";import"./isFocusVisible-B8k4qzLc.js";import"./FormControl-BpWV3VDf.js";import"./isMuiElement-BOwKGjxf.js";import"./Modal-CVujTFOw.js";import"./createChainedFunction-BO_9K8Jh.js";import"./utils-TS7gOHXB.js";import"./Popover-DKSgKXB-.js";import"./Paper-B8YcVVca.js";import"./Grow-DtN_YV5L.js";import"./Menu-BWxVMNIi.js";import"./List-BxElNHcx.js";import"./listItemTextClasses-D6I-qz9g.js";import"./useControlled-B5xzdI43.js";import"./createSvgIcon-DpKUgtm0.js";import"./lock-D7BFDH4B.js";import"./check-BjKssNkE.js";import"./CircularProgress-CnPELIce.js";import"./langs-DUiJXdIq.js";import"./normalizeDates-Bl5IZJGD.js";import"./toDate-BXq0HhWu.js";import"./useLocalStorage-DuUvOJRe.js";import"./Collapse-CnjxOpna.js";import"./Trans-EtLtbqsJ.js";import"./format-Cv4mH62M.js";import"./differenceInCalendarDays-DiZ3ZI30.js";import"./getTimezoneOffsetInMilliseconds-CkMJBntH.js";import"./x-BHbqH91-.js";import"./index-8QNzrxwJ.js";import"./pen-Lz7yweGr.js";import"./index-CInzS905.js";import"./index-Chjiymov.js";import"./index-DgzpB3yj.js";import"./index-RERcJu9w.js";import"./MenuItem-BDQospWL.js";import"./dividerClasses-bGF6_inT.js";import"./Edit-0RR_ZIqV.js";import"./ListItemText-DtIE91_b.js";import"./Delete-Dky7-0Yw.js";import"./ListItemIcon-B3CKIE52.js";import"./link-t0gZlfUa.js";import"./index.esm-ByZbOMQw.js";import"./DialogContent-BVO65bHL.js";import"./DialogActions-hH_AKLy2.js";import"./Link-DghQZPZy.js";import"./differenceInSeconds-DNsH8fUT.js";import"./download-Cr-ydt7j.js";import"./fileItem-Bbp5pYua.js";import"./itemType-D9KQEJss.js";import"./mimeTypes-Bpmm_hmI.js";import"./fileSize-Ct-TZ2my.js";import"./validate-DVgNBRRM.js";import"./appItem-PW1ezbEO.js";import"./url-DDYejV_U.js";import"./AccordionSummary-4HQnX5ST.js";import"./chevron-down-DS52ak5B.js";import"./alignment-FBy0_b-y.js";import"./external-link-BbK42ISd.js";import"./linkItem-VVVu8jA7.js";import"./item-dXKRHMD1.js";import"./stringify-D92ucQ0I.js";import"./StyledBaseComponents-CGx14SPL.js";import"./text-align-start-B7PT5KlE.js";import"./Avatar-BsacKTQe.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],Gt=V("arrow-left-right",$t);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Vt=V("map-pin",Wt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=[["path",{d:"m15 15 6 6m-6-6v4.8m0-4.8h4.8",key:"17vawe"}],["path",{d:"M9 19.8V15m0 0H4.2M9 15l-6 6",key:"chjx8e"}],["path",{d:"M15 4.2V9m0 0h4.8M15 9l6-6",key:"lav6yq"}],["path",{d:"M9 4.2V9m0 0H4.2M9 9 3 3",key:"1pxi2q"}]],qt=V("shrink",Xt);function zt(){const{user:e,logout:n,isAuthenticated:r}=M(),{t:s}=x(I.Player,{keyPrefix:"FORBIDDEN_CONTENT"});return t.jsxs(C,{id:Ee,direction:"column",height:"100%",justifyContent:"center",alignItems:"center",spacing:2,children:[t.jsx(rt,{id:Ce,memberId:e?.id,title:s("ERROR_ACCESSING_ITEM"),authenticatedText:s("ERROR_ACCESSING_ITEM_HELPER")}),r?t.jsx(pe,{onClick:()=>{n()},variant:"outlined",startIcon:t.jsx(Gt,{}),children:s("LOG_OUT_BUTTON")}):t.jsx(ue,{variant:"outlined",to:"/auth/login",search:{url:window.location.toString()},children:s("LOG_IN_BUTTON")})]})}const ge=h.createContext({isPinnedOpen:!0,setIsPinnedOpen:()=>{throw new Error("No context")},isChatboxOpen:!1,setIsChatboxOpen:()=>{throw new Error("No context")},isFullscreen:!1,setIsFullscreen:()=>{throw new Error("No context")},toggleChatbox:()=>{throw new Error("No context")},togglePinned:()=>{throw new Error("No context")}}),Kt=({children:e})=>{const{isMobile:n}=me(),[r,s]=h.useState(!n),[i,o]=h.useState(!1),[a,l]=h.useState(!1);h.useEffect(()=>{s(!n)},[n]);const u=h.useMemo(()=>({isPinnedOpen:r,setIsPinnedOpen:s,isChatboxOpen:i,setIsChatboxOpen:o,isFullscreen:a,setIsFullscreen:l,toggleChatbox:()=>{o(d=>!d),r&&s(!1)},togglePinned:()=>{s(d=>!d),i&&o(!1)}}),[r,s,i,o,a,l]);return t.jsx(ge.Provider,{value:u,children:e})},z=()=>h.useContext(ge);var S={},ee;function Zt(){if(ee)return S;ee=1,Object.defineProperty(S,"__esModule",{value:!0}),S.getFullScreenEnabled=void 0;const e=Te(),n={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},r=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],s=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],i=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],o=typeof window<"u"&&typeof window.document<"u"?window.document:{},a="fullscreenEnabled"in o&&Object.keys(n)||r[0]in o&&r||s[0]in o&&s||i[0]in o&&i||[];class l{static requestFullscreen(c){return c[a[n.requestFullscreen]]()}static requestFullscreenFunction(c){return c[a[n.requestFullscreen]]}static get exitFullscreen(){return o[a[n.exitFullscreen]].bind(o)}static addEventListener(c,m,f){return o.addEventListener(a[n[c]],m,f)}static removeEventListener(c,m,f){return o.removeEventListener(a[n[c]],m,f)}static get fullscreenEnabled(){return!!o[a[n.fullscreenEnabled]]}static set fullscreenEnabled(c){}static get fullscreenElement(){return o[a[n.fullscreenElement]]}static set fullscreenElement(c){}static get onfullscreenchange(){return o[`on${a[n.fullscreenchange]}`.toLowerCase()]}static set onfullscreenchange(c){o[`on${a[n.fullscreenchange]}`.toLowerCase()]=c}static get onfullscreenerror(){return o[`on${a[n.fullscreenerror]}`.toLowerCase()]}static set onfullscreenerror(c){o[`on${a[n.fullscreenerror]}`.toLowerCase()]=c}}const u=()=>l.fullscreenEnabled;S.getFullScreenEnabled=u;class d extends e.Component{constructor(c){super(c),this.detectFullScreen=()=>{this.props.onChange&&this.props.onChange(!!l.fullscreenElement),this.props.onOpen&&l.fullscreenElement&&this.props.onOpen(),this.props.onClose&&!l.fullscreenElement&&this.props.onClose()},this.enterFullScreen=()=>{l.requestFullscreen(this.node)},this.leaveFullScreen=()=>{l.exitFullscreen()}}componentDidMount(){l.addEventListener("fullscreenchange",this.detectFullScreen,{})}componentWillUnmount(){l.removeEventListener("fullscreenchange",this.detectFullScreen,{})}componentDidUpdate(){this.handleProps(this.props)}handleProps(c){const m=l.fullscreenElement;m&&!c.enabled?this.leaveFullScreen():!m&&c.enabled&&this.enterFullScreen()}render(){return e.createElement("div",{className:"FullScreen",ref:c=>this.node=c,style:{height:"100%",width:"100%"}},this.props.children)}}return S.default=d,d.defaultProps={enabled:!1},S}var Yt=Zt();const Qt=be(Yt),Jt=10;var G=new Map,B=new WeakMap,te=0,en=void 0;function tn(e){return e?(B.has(e)||(te+=1,B.set(e,te.toString())),B.get(e)):"0"}function nn(e){return Object.keys(e).sort().filter(n=>e[n]!==void 0).map(n=>`${n}_${n==="root"?tn(e.root):e[n]}`).toString()}function rn(e){const n=nn(e);let r=G.get(n);if(!r){const s=new Map;let i;const o=new IntersectionObserver(a=>{a.forEach(l=>{var u;const d=l.isIntersecting&&i.some(p=>l.intersectionRatio>=p);e.trackVisibility&&typeof l.isVisible>"u"&&(l.isVisible=d),(u=s.get(l.target))==null||u.forEach(p=>{p(d,l)})})},e);i=o.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),r={id:n,observer:o,elements:s},G.set(n,r)}return r}function sn(e,n,r={},s=en){if(typeof window.IntersectionObserver>"u"&&s!==void 0){const u=e.getBoundingClientRect();return n(s,{isIntersecting:s,target:e,intersectionRatio:typeof r.threshold=="number"?r.threshold:0,time:0,boundingClientRect:u,intersectionRect:u,rootBounds:u}),()=>{}}const{id:i,observer:o,elements:a}=rn(r),l=a.get(e)||[];return a.has(e)||a.set(e,l),l.push(n),o.observe(e),function(){l.splice(l.indexOf(n),1),l.length===0&&(a.delete(e),o.unobserve(e)),a.size===0&&(o.disconnect(),G.delete(i))}}function on({threshold:e,delay:n,trackVisibility:r,rootMargin:s,root:i,triggerOnce:o,skip:a,initialInView:l,fallbackInView:u,onChange:d}={}){var p;const[c,m]=h.useState(null),f=h.useRef(d),[T,F]=h.useState({inView:!!l,entry:void 0});f.current=d,h.useEffect(()=>{if(a||!c)return;let _;return _=sn(c,(E,L)=>{F({inView:E,entry:L}),f.current&&f.current(E,L),L.isIntersecting&&o&&_&&(_(),_=void 0)},{root:i,rootMargin:s,threshold:e,trackVisibility:r,delay:n},u),()=>{_&&_()}},[Array.isArray(e)?e.toString():e,c,i,s,o,a,r,u,n]);const v=(p=T.entry)==null?void 0:p.target,D=h.useRef(void 0);!c&&v&&!o&&!a&&D.current!==v&&(D.current=v,F({inView:!!l,entry:void 0}));const b=[m,T.inView,T.entry];return b.ref=b[0],b.inView=b[1],b.entry=b[2],b}const an="3.5em",ln="8.125em",K=({isChildren:e,isCollapsible:n,itemType:r,screenMaxHeight:s})=>{switch(!0){case n:return t.jsx(j,{variant:"rectangular",width:"100%",height:an});case(r==="folder"&&e):return null;case r==="folder":return t.jsx(j,{variant:"rectangular",width:"100%",height:ln});case["file","embeddedLink","app"].includes(r):return t.jsx(j,{variant:"rectangular",width:"100%",height:s||xt});case r==="document":return t.jsxs(t.Fragment,{children:[t.jsx(j,{variant:"text"}),t.jsx(j,{variant:"text"}),t.jsx(j,{variant:"text"})]});default:return t.jsx(j,{variant:"rectangular",width:"100%"})}},Z=e=>({border:"unset",padding:"8px",transition:"all ease 100ms",borderRadius:e.spacing(1),height:"40px",width:"40px","&:hover":{cursor:"pointer"},"&[disabled] svg":{color:"gray"},"&[disabled]":{backgroundColor:"#e9e9e9",cursor:"not-allowed"}}),ne=y("button")(({theme:e})=>({...Z(e),animation:"skeletonAnimation 2s ease-in-out 0.5s infinite","@keyframes skeletonAnimation":{"0%":{opacity:1},"50%":{opacity:.4},"100%":{opacity:1}}})),Y=y("button")(({theme:e})=>({...Z(e),backgroundColor:"#CEE5FF","& svg":{color:"#00639A"},"&:hover:not([disabled])":{backgroundColor:"#A2CEFF"}})),cn=y("a")(({theme:e})=>({...Z(e),backgroundColor:"#E4DFFF","& svg":{color:e.palette.primary.main},"&:hover:not([disabled])":{backgroundColor:"#BFB4FF"}})),dn=h.forwardRef((e,n)=>t.jsx(cn,{ref:n,...e})),un=ie(dn),re=e=>t.jsx(un,{preload:"intent",...e}),pn=()=>{const{t:e}=x(I.Player),{itemId:n,rootId:r}=w({from:"/player/$rootId/$itemId"}),{data:s}=g.useItem(n),{data:i}=g.useItem(r),{data:o}=g.useDescendants({id:r,types:["folder"],showHidden:!1}),{toggleChatbox:a,isChatboxOpen:l}=z();if((o?.filter(({settings:d})=>d.showChatbox)??[]).length>0||i?.settings.showChatbox){const d=s?.permission?he.gte(s?.permission,"write"):!1,p=!s?.settings?.showChatbox,c=e(d?"NAVIGATION_ISLAND_CHAT_BUTTON_HELPER_TEXT_WRITERS":"NAVIGATION_ISLAND_CHAT_BUTTON_HELPER_TEXT_READERS");return{chatButton:t.jsx(k,{title:p?c:void 0,arrow:!0,children:t.jsx("span",{children:t.jsx(Y,{disabled:p,id:_e,onClick:a,"aria-label":e(l?"HIDE_CHAT_TOOLTIP":"SHOW_CHAT_TOOLTIP"),children:l?t.jsx(jt,{}):t.jsx(St,{})},"chatButton")})})}}return{chatButton:null}},mn=je.getInstance(),hn=()=>{const{t:e}=x(I.Player),{itemId:n,rootId:r}=w({from:"/player/$rootId/$itemId"}),{data:s}=g.useItem(n),{data:i}=vt({parentItemId:r}),{data:o}=Lt(s?.id);if(!i?.length)return{geolocationButton:null};const a=o?mn.getItemLink(ae.Builder,o.item.id,{mode:"map"}):null,l=!o,u=l?e("MAP_BUTTON_DISABLED_TEXT"):e("MAP_BUTTON_TEXT",{name:o.item.name}),d=t.jsx("span",{id:Se,children:t.jsx(Y,{disabled:l,"aria-label":u,children:t.jsx(Vt,{})},"mapButton")}),p=a?t.jsx(Ne,{to:a,children:d}):d;return{geolocationButton:t.jsx(k,{title:u,children:p})}},fn=()=>{const{t:e}=x(I.Player),{togglePinned:n,isPinnedOpen:r}=z(),{itemId:s}=w({from:"/player/$rootId/$itemId"}),{data:i}=g.useItem(s),{data:o}=g.useChildren(s,void 0,{enabled:!!i}),a=o?.filter(({settings:c,hidden:m})=>c.isPinned&&!m)?.length??0;if(a<=0)return{pinnedButton:null};const l=i?.permission?he.gte(i?.permission,"write"):!1,u=r&&a>0,d=a<=0,p=e(l?"NAVIGATION_ISLAND_PINNED_BUTTON_HELPER_TEXT_WRITERS":"NAVIGATION_ISLAND_PINNED_BUTTON_HELPER_TEXT_READERS");return{pinnedButton:t.jsx(k,{title:d?p:void 0,arrow:!0,children:t.jsx("span",{children:t.jsx(Y,{disabled:d,id:ye,onClick:n,"aria-label":e(u?"HIDE_PINNED_ITEMS_TOOLTIP":"SHOW_PINNED_ITEMS_TOOLTIP"),children:u?t.jsx(yt,{}):t.jsx(wt,{})},"pinnedButton")})})}};function gn(e,n){const r=n.findIndex(({id:s})=>s===e);return r<0?null:n[r-1]}function xn(e,n){const r=n.findIndex(({id:s})=>s===e);return r<0||r+1>n.length?null:n[r+1]}function In(){const{rootId:e,itemId:n}=w({from:"/player/$rootId/$itemId/"}),r=X({from:"/player/$rootId/$itemId/"}),{user:s}=M(),{data:i}=g.useItem(e),{shuffle:o}=r,{data:a,isLoading:l}=g.useDescendants({id:e,types:["folder"],showHidden:!1,enabled:!!e});if(l)return{previousButton:t.jsx(ne,{disabled:!0,children:t.jsx(J,{})}),nextButton:t.jsx(ne,{disabled:!0,children:t.jsx($,{})})};if(!Array.isArray(a)||!i)return{previousButton:null,nextButton:null};const u=o?Ot(a,Rt(e,s?.id)):a,d=[i,...u],p=gn(n,d),c=xn(n,d);return!p&&!c?{previousButton:null,nextButton:null}:{previousButton:t.jsx(re,{id:ve,disabled:!p,to:"/player/$rootId/$itemId",params:{rootId:e,itemId:p?.id??""},search:r,children:t.jsx(J,{})},"previousButton"),nextButton:t.jsx(re,{id:we,disabled:!c,to:"/player/$rootId/$itemId",params:{rootId:e,itemId:c?.id??""},search:r,children:t.jsx($,{})},"nextButton")}}const xe=()=>{const{previousButton:e,nextButton:n}=In(),{chatButton:r}=pn(),{geolocationButton:s}=hn(),{pinnedButton:i}=fn();return!r&&!i&&!e&&!n&&!s?null:t.jsx(q,{className:Le,bgcolor:"white",boxShadow:"0px 3px 6px 0px rgba(0, 0, 0, 0.25)",borderRadius:"16px 16px 0px 0px",position:"fixed",bottom:0,margin:"auto",left:"0",right:"0",maxWidth:"max-content",zIndex:998,p:1,children:t.jsxs(C,{direction:"row",flexGrow:1,gap:10,children:[e&&n&&t.jsxs(C,{direction:"row",gap:1,children:[e,n]}),(r||i||s)&&t.jsxs(C,{direction:"row",gap:1,children:[r,i,s]})]})})};function En({thumbnail:e,alt:n,width:r,minHeight:s,type:i="folder"}){const o=le();return e?t.jsx(Pt,{url:e,alt:n,maxHeight:"100%",maxWidth:r}):t.jsx(q,{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:Oe.main,width:r,height:"100%",flexShrink:0,minHeight:s,minWidth:0,children:t.jsx(At,{type:i,alt:n,color:o.palette.primary.main})})}const H=76,Cn=h.forwardRef((e,n)=>{const{id:r,name:s,description:i,thumbnail:o,...a}=e,l=le();return t.jsx(Ft,{id:r,sx:{width:"max-content",maxWidth:"100%",height:H},children:t.jsx(Dt,{component:"a",ref:n,sx:{height:"100%"},...a,children:t.jsxs(C,{direction:"row",alignItems:"center",height:"100%",minWidth:0,children:[t.jsx(En,{width:H,minHeight:H,thumbnail:o,alt:s,type:"folder"}),t.jsx(bt,{sx:{minWidth:"0px","& .MuiCardHeader-content":{minWidth:"0px"}},title:s,subheader:i,titleTypographyProps:{color:"primary",minWidth:"0px",noWrap:!0,width:"100%"},subheaderTypographyProps:{overflow:"hidden",height:i?"1lh":"unset",textOverflow:"ellipsis",minWidth:0,sx:{"& p":{margin:0,marginBlocStart:0}}}}),t.jsx($,{size:35,color:l.palette.primary.main,style:{flexShrink:0,margin:l.spacing(2,2,2,0)}})]})})})}),Tn=ie(Cn),bn=e=>t.jsx(Tn,{preload:"intent",...e}),_n="(?=.*[0-9])(?=.*[a-zA-Z])([a-z0-9-]+)";function jn(){const e=X({from:"/player/$rootId/$itemId/"}),{t:n}=x(I.Player),{from:r,fromName:s}=e;return!r||!s||!new RegExp(`/${_n}`).exec(r)?.length?null:r?t.jsx(C,{direction:"column",justifyContent:"center",alignItems:"center",children:t.jsx(ue,{id:Re,to:r,search:e,variant:"outlined",startIcon:t.jsx(Bt,{}),color:"warning",sx:{textTransform:"unset"},children:n("FROM_SHORTCUT_BUTTON_TEXT",{name:s})})}):null}function A(e){const{mutate:n}=Pe({...ce(),onError:s=>{console.error(s)}});return{triggerAction:n,onCollapse:s=>{n({path:{id:e},body:{type:s?O.CollapseItem:O.UnCollapseItem}})}}}const Nn=()=>{const{rootId:e,itemId:n}=w({from:"/player/$rootId/$itemId/"}),{data:r}=g.useItem(e),{data:s}=g.useItem(n);if(r&&s)return e!==n?`${s.name} | ${r.name}`:s.name},Sn=e=>e.filter(n=>n.type!=="folder").filter(n=>!n.settings?.isPinned),se=de("/player/$rootId/$itemId"),yn=!1,wn=ht(),R=window.innerHeight*.8,{useEtherpad:vn,useItem:Ie,useChildren:Ln,useFileContentUrl:On,useChildrenPaginated:Rn}=g,Pn=({item:e})=>{const{t:n}=x(I.Common),r=vn(e,"write");return r?.isLoading?t.jsx(K,{itemType:e.type,isChildren:!1,screenMaxHeight:R}):r?.isError?t.jsx(N,{severity:"error",children:n("ERRORS.UNEXPECTED")}):r?.data?.padUrl?t.jsx(dt,{itemId:e.id,padUrl:r.data.padUrl,options:{showLineNumbers:!1,showControls:!1,showChat:!1,noColors:!0},style:{height:"80vh"}}):t.jsx(N,{severity:"error",children:n("ERRORS.UNEXPECTED")})},An=({item:e})=>{const{t:n}=x(I.Common),{data:r,isPending:s,isError:i}=On(e.id),{triggerAction:o,onCollapse:a}=A(e.id),l=h.useCallback(()=>{o({path:{id:e.id},body:{type:O.ItemDownload}})},[e.id]);return e?t.jsx(mt,{id:He(e.id),item:e,fileUrl:r,maxHeight:R,showCollapse:e.settings?.isCollapsible,pdfViewerLink:wn?.toString(),onClick:l,onCollapse:a}):s?t.jsx(K,{itemType:"file",isChildren:!1,screenMaxHeight:R}):(i&&console.error(i),t.jsx(N,{severity:"error",children:n("ERRORS.UNEXPECTED")}))},Fn=({item:e})=>{const{user:n}=M(),{triggerAction:r,onCollapse:s}=A(e.id),i=()=>{r({path:{id:e.id},body:{type:O.LinkOpen}})};return t.jsx(q,{id:Ue(e.id),children:t.jsx(_t,{id:e.id,item:e,height:R,memberId:n?.id,isResizable:!0,showButton:e.settings?.showLinkButton,showIframe:e.settings?.showLinkIframe,showCollapse:e.settings?.isCollapsible,onClick:i,onCollapse:s})})},Dn=({item:e})=>{const{onCollapse:n}=A(e.id);return t.jsx(pt,{id:ke(e.id),item:e,showCollapse:e.settings?.isCollapsible,onCollapse:n})},Bn=({item:e})=>{const{user:n}=M(),{onCollapse:r}=A(e.id);return t.jsxs(t.Fragment,{children:[!n&&t.jsxs(N,{severity:"warning",children:[t.jsx(Mt,{children:"Viewing app as an anonymous user"}),"When viewing applications as an anonymous user, you might not be able to properly interact with them. Data will not be saved. Log in to save your progress."]}),t.jsx(It,{frameId:Me(e.id),item:e,memberId:n?.id,requestApiAccessToken:s=>Et(s),isResizable:e.settings?.isResizable||yn,contextPayload:{apiHost:Be,settings:e.settings,lang:e.lang??n?.lang,permission:"read",context:ae.Player,accountId:n?.id,itemId:e.id},showCollapse:e.settings?.isCollapsible,onCollapse:r})]})},Mn=({item:e})=>{const{t:n}=x(I.Common),{onCollapse:r}=A(e.id),s=e?.extra?.h5p?.contentId;return s?t.jsx(ut,{itemId:e.id,itemName:e.name,contentId:s,integrationUrl:De,showCollapse:e.settings?.isCollapsible,onCollapse:r}):t.jsx(N,{severity:"error",children:n("ERRORS.UNEXPECTED")})},kn=({item:e})=>e.settings.isCollapsible?t.jsx("span",{id:Fe(e.id),children:Ct({item:e})(t.jsx(W,{isChildren:!0,id:e.extra?.shortcut?.target}))}):t.jsx(W,{isChildren:!0,id:e.extra?.shortcut?.target}),Hn=({item:e})=>{const n=se.useSearch(),{itemId:r}=se.useParams(),{data:s}=Ie(r),i=e.thumbnails?.medium,o=new URLSearchParams(n.toString());return o.set("from",window.location.pathname),s&&o.set("fromName",s.name),t.jsx(bn,{id:$e(e.id),name:e.name,thumbnail:i,description:e.description&&e.description!=="<p><br></p>"?t.jsx(Tt,{content:e.description??""}):void 0,to:"/player/$rootId/$itemId",params:{rootId:e.id,itemId:e.id},search:{...n,from:window.location.pathname,...s?{fromName:s.name}:{}}})},Un=({item:e})=>{switch(e.type){case"folder":return t.jsx(Hn,{item:e});case"embeddedLink":return t.jsx(Fn,{item:e});case"file":return t.jsx(An,{item:e});case"document":return t.jsx(Dn,{item:e});case"app":return t.jsx(Bn,{item:e});case"h5p":return t.jsx(Mn,{item:e});case"etherpad":return t.jsx(Pn,{item:e});case"shortcut":return t.jsx(kn,{item:e});case"page":return t.jsx(ct,{item:e});default:return console.error("The type of item is not defined",e),null}},P=({item:e})=>e.hidden?null:t.jsx(Un,{item:e}),$n=({item:e,showPinnedOnly:n=!1})=>{const{ref:r,inView:s}=on(),{t:i}=x(I.Player),{data:o=[],isLoading:a}=Ln(e.id,void 0,{getUpdates:!0}),{data:l,refetch:u,hasNextPage:d,isFetchingNextPage:p,fetchNextPage:c}=Rn(e.id,o,{enabled:!!(!n&&o&&!a),filterFunction:Sn});h.useEffect(()=>{o&&u(),s&&c()},[s,o]);const m=!d||p?null:t.jsx(Q,{ref:r,children:t.jsx(pe,{disabled:!d||p,onClick:()=>c(),fullWidth:!0,children:i("LOAD_MORE")})});return n?o?.filter(f=>n===(f.settings?.isPinned||!1))?.map(f=>t.jsx(P,{item:f},f.id)):t.jsxs(t.Fragment,{children:[t.jsx(Q,{maxWidth:"lg",children:t.jsxs(C,{direction:"column",pb:7,spacing:2,margin:"auto",children:[t.jsx(lt,{item:e}),t.jsx(fe,{flexItem:!0}),t.jsx(C,{direction:"column",gap:4,children:l?.pages?.map(f=>t.jsx(h.Fragment,{children:f.data.map(T=>t.jsx(P,{item:T},T.id))},f.pageNumber))}),m]})}),t.jsx(jn,{}),t.jsx(xe,{})]})},W=({id:e,isChildren:n=!1,showPinnedOnly:r=!1})=>{const{t:s}=x(I.Common),{data:i,isLoading:o,isError:a}=Ie(e),l=Nn();return i&&i.type==="folder"?n?t.jsx(P,{item:i}):t.jsxs(t.Fragment,{children:[t.jsx(Ae,{children:t.jsx("title",{children:l})}),t.jsx($n,{item:i,showPinnedOnly:r})]}):o?t.jsx(K,{itemType:"folder",isChildren:n,screenMaxHeight:R}):i?t.jsxs(t.Fragment,{children:[t.jsx(P,{item:i}),n?!1:t.jsx(xe,{})]}):a||!i?t.jsx(N,{severity:"error",children:s("ERRORS.UNEXPECTED")}):null},Gn=y(Ht)(({theme:e})=>({width:U,flexShrink:0,"& .MuiDrawer-paper":{width:U,padding:e.spacing(1),backgroundColor:We}})),oe=({children:e,onClose:n,title:r,open:s})=>t.jsxs(Gn,{anchor:"right",variant:"persistent",open:s,children:[t.jsx(kt,{}),t.jsx(ft,{handleDrawerClose:n,children:t.jsx(Ge,{variant:"h6",children:r})}),t.jsx(fe,{}),e]}),Wn=y("div",{shouldForwardProp:e=>e!=="isShifted"})(({theme:e,isShifted:n})=>{const r=n?{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:U}:{};return{position:"relative",flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0,...r}}),Vn=y(Ut)({float:"right",zIndex:Jt}),Xn=({content:e,item:n})=>{const{rootId:r}=w({from:"/player/$rootId/$itemId"}),{isMobile:s}=me(),{data:i}=g.useChildren(n.id,void 0,{enabled:!!n}),o=X({from:"/player/$rootId/$itemId"}),{toggleChatbox:a,togglePinned:l,isChatboxOpen:u,isPinnedOpen:d,isFullscreen:p,setIsFullscreen:c}=z(),{t:m}=x(I.Player),f=n.settings??{};if(!r)return null;const T=i?.filter(({settings:E,hidden:L})=>E.isPinned&&!L),F=T?.length??0,v=()=>{c(!p)},D=()=>{const{fullscreen:E}=o;return s||!E?null:t.jsx(k,{title:m(p?"EXIT_FULLSCREEN_TOOLTIP":"ENTER_FULLSCREEN_TOOLTIP"),children:t.jsx(Vn,{id:ze,"aria-label":m(p?"EXIT_FULLSCREEN_TOOLTIP":"ENTER_FULLSCREEN_TOOLTIP"),onClick:v,children:p?t.jsx(qt,{}):t.jsx(Nt,{})})})},b=()=>f?.showChatbox?t.jsx("div",{id:Ve,children:t.jsx(oe,{title:m("ITEM_CHATBOX_TITLE",{name:n.name}),onClose:a,open:u,children:t.jsx(gt,{itemId:n.id,id:Xe})})}):null,_=()=>T?.length?t.jsx(oe,{title:m("PINNED_ITEMS"),onClose:l,open:d,children:t.jsx(C,{id:qe,gap:2,mt:1,pb:9,children:T.map(E=>t.jsx(P,{item:E},E.id))})}):null;return t.jsxs(Qt,{enabled:p,onChange:E=>c(E),children:[b(),_(),t.jsx(C,{id:"contentGrid",children:t.jsxs(Wn,{isShifted:u||d&&F>0,children:[D(),e]})})]})},qn=()=>{const{itemId:e}=de("/player/$rootId/$itemId").useParams(),{data:n,isLoading:r,isError:s}=g.useItem(e),{t:i}=x(I.Player),{mutate:o}=Ke({...ce(),onError:l=>{console.error(l)}}),a=t.jsxs(C,{gap:2,children:[t.jsx(at,{suffix:"player"}),t.jsx(W,{id:e})]});return h.useEffect(()=>{e&&n&&o({path:{id:e},body:{type:O.ItemView}})},[e,n,o]),n?t.jsx(Kt,{children:t.jsx(Xn,{item:n,content:a})}):r?t.jsx(j,{variant:"rectangular",width:"100%"}):s?t.jsx(N,{severity:"error",children:i("ERROR_FETCHING_ITEM")}):null};function Hs(){const{itemId:e}=Ze.useParams(),{data:n}=g.useCurrentMember(),{data:r,isFetching:s,error:i}=g.useItem(e),{data:o,isFetching:a,isError:l}=g.useItemLoginSchemaType({itemId:e}),{mutate:u}=Ye.usePostItemLogin(),d=Qe(i)&&i.status||null;return t.jsx(st,{itemId:e,item:r,currentAccount:n,signIn:u,itemErrorStatusCode:d,itemLoginSchemaType:o,usernameInputId:tt,signInButtonId:et,passwordInputId:Je,enrollContent:t.jsx(it,{itemId:e}),forbiddenContent:t.jsx(zt,{}),requestAccessContent:n?.type===nt.Individual&&!l?t.jsx(ot,{itemId:e,member:n}):void 0,isLoading:s||a,children:t.jsx(qn,{})})}export{Hs as component};
