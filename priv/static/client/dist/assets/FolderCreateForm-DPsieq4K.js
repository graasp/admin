import{v as S,j as e,s as v,i as U,r as I,S as _,az as k,T as D,b as O,N as F,dP as L,Z as A,f as w,en as T,eo as B,g as q,k as H,m as z,ep as X,e2 as Z,eq as G,dI as Q}from"./index-Du6cLc2g.js";import{C as V}from"./CustomLink-C-uYfSDk.js";import{d as K,H as W,u as $,F as J,I as Y,e as ee}from"./LinkTypeFormControl-DEWxmDYc.js";import{B as te}from"./Button-BZonE8EM.js";import{B as M}from"./Box-6qYIb0IB.js";import{A as se}from"./Alert-CbKF_a_e.js";import{C as oe}from"./circle-question-mark-4vLz0IMx.js";import{u as re,F as ne}from"./index.esm-ByZbOMQw.js";import{G as P}from"./Button-D6pY2JNh.js";import{C as ae}from"./CancelButton-D_f8GGBm.js";import{T as ie}from"./ThumbnailCrop-iU1PYi3L.js";import{D as le}from"./DialogTitle-DnHtd1CR.js";import{a as ce}from"./DialogContent-BVO65bHL.js";import{D as de}from"./DialogActions-hH_AKLy2.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],N=S("cloud-upload",me),pe=v("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),ue=({id:t,isLoading:l=!1,onChange:d,loadingText:r="Uploading...",text:n="Upload a file",variant:m="contained",accept:x,multiple:s,icon:p=e.jsx(N,{}),size:u,color:a})=>e.jsxs(te,{id:t,component:"label",variant:m,color:a,startIcon:p,loading:l,disabled:l,size:u,children:[l?r:n,e.jsx(pe,{multiple:s,onChange:d,type:"file",accept:x})]}),he=({id:t,onDrop:l,onChange:d,error:r,hints:n,buttonText:m="Browse files",buttons:x,multiple:s,message:p="Drag your files here to upload or",releaseText:u="Release to drop",uploadProgress:a,isLoading:h=!1})=>{const b=U(),E=I.useRef(null),[{canDrop:j,isOver:C},y]=$({accept:[J],drop:o=>{l?.(o.files)},canDrop:()=>!h,collect:o=>({isOver:o.isOver(),canDrop:o.canDrop()})});y(E);const f=j&&C;let g="#eeeefa";return f?g="#dcdcf6":!j&&C&&(g="#ffbaba"),e.jsxs(_,{direction:"column",role:"dropzone",component:"div",id:t,height:"100%",width:"100%",justifyContent:"center",alignItems:"center",bgcolor:r?"#ffbaba":g,borderRadius:5,ref:E,gap:2,sx:{borderStyle:"dashed",borderWidth:3,borderColor:r?"red":"lightgrey"},py:4,boxSizing:"border-box",children:[e.jsx(N,{size:80,color:r?"red":b.palette.primary.main}),h?e.jsxs(M,{width:"100%",px:5,children:[e.jsx(k,{variant:a?"determinate":"indeterminate",color:"primary",value:a}),a&&e.jsxs(D,{textAlign:"center",children:[a,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"label",color:r?"error":"primary",children:f?u:p}),e.jsxs(_,{direction:"row",gap:2,children:[m&&e.jsx(ue,{icon:null,text:m,onChange:d,size:"small",multiple:s}),x]}),n&&e.jsx(D,{variant:"caption",children:n}),r&&e.jsx(se,{severity:"error",children:r})]})]})},xe=t=>e.jsx(K,{backend:W,context:window,children:e.jsx(he,{error:t.error,hints:t.hints,onChange:t.onChange,id:t.id,onDrop:t.onDrop,buttonText:t.buttonText,buttons:t.buttons,multiple:t.multiple,isLoading:t.isLoading,uploadProgress:t.uploadProgress,message:t.message})});function Pe({onError:t,onUpdate:l,onComplete:d,onStart:r,buttons:n,id:m,previousItemId:x}){const{t:s}=O(F.Builder),{t:p}=O(F.Messages),{itemId:u}=L({strict:!1}),[a,h]=I.useState(),{mutateAsync:b,isPending:E}=A.useUploadFiles(),{color:j}=w("primary"),[C,y]=I.useState(0),f=async o=>{const i=()=>c=>{const R=(c.progress??0)/o.length;y(R),l?.({...c,progress:R})};if(o.length>T){h(s("CANNOT_UPLOAD_MORE_FILES",{count:T})),t?.({message:s("CANNOT_UPLOAD_MORE_FILES",{count:T})});return}h(void 0),r?.();try{await b({files:o,id:u,previousItemId:x,onUploadProgress:i()}),d?.()}catch(c){const R=B(c);h(p(R)??p("UPLOAD_FILES_UNEXPECTED_ERROR")),c instanceof Error&&t?.(c),console.error(c)}},g=e.jsxs(_,{gap:2,children:[e.jsx(D,{variant:"subtitle2",textAlign:"center",children:s("DROPZONE_HELPER_LIMIT_REMINDER_TEXT",{max:T})}),e.jsxs(_,{direction:"row",alignItems:"center",gap:1,children:[e.jsx(oe,{size:20,color:j}),e.jsx(V,{variant:"subtitle2",to:"/support",children:s("DROPZONE_HELPER_TUTORIALS")})]})]});return e.jsx(M,{width:"100%",id:m,height:"100%",children:e.jsx(xe,{message:s("DROPZONE_HELPER_TEXT"),onChange:o=>{o.target.files&&f([...o.target.files])},isLoading:E,uploadProgress:Math.ceil(C*100),multiple:!0,onDrop:f,error:a?e.jsxs(e.Fragment,{children:[a,e.jsx("br",{}),s("FILE_UPLOADER.GENERAL_ERROR")]}):void 0,buttonText:s("DROPZONE_HELPER_ACTION"),hints:g,buttons:n})})}function Le({onClose:t,geolocation:l,previousItemId:d}){const{navigate:r}=q(),{itemId:n}=L({strict:!1}),[m,x]=I.useState(0),{t:s}=O(F.Builder),{t:p}=O(F.Common),u=re({mode:"onChange"}),{handleSubmit:a,formState:{isValid:h}}=u,[b,E]=I.useState(),{mutateAsync:j}=A.usePostItem(),C=H(),{mutateAsync:y}=z({...X(),onSuccess:()=>{C.invalidateQueries({queryKey:Z.single(n).allChildren})}}),f=()=>{n&&x(i=>i+1)};async function g(i){try{await j({name:i.name,type:"folder",description:i.description,thumbnail:b,parentId:n,geolocation:l,previousItemId:d}),t()}catch(c){console.error(c)}}const o=async()=>{const{id:i}=await y({body:{name:"create page"},query:{parentId:n,previousItemId:d}});r({to:"/builder/items/$itemId",params:{itemId:i}})};return e.jsx(ne,{...u,children:e.jsxs(_,{component:"form",direction:"column",onSubmit:a(g),flex:1,children:[e.jsx(le,{onClick:f,children:s("CREATE_ITEM_NEW_FOLDER_TITLE")}),e.jsxs(ce,{children:[e.jsxs(_,{direction:"row",justifyContent:"flex-start",alignItems:"flex-start",gap:2,children:[e.jsx(ie,{setChanges:({thumbnail:i})=>{E(i)}}),e.jsx(Y,{required:!0})]}),e.jsx(ee,{id:G})]}),e.jsxs(de,{children:[m>3&&e.jsx(P,{color:"player",onClick:o,children:"Create Page"}),e.jsx(ae,{onClick:t}),e.jsx(P,{id:Q,type:"submit",disabled:!h,children:p("SAVE.BUTTON_TEXT")})]})]})})}export{Pe as F,ue as U,Le as a};
