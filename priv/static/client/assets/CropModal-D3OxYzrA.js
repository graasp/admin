import{v as U,r as M,bF as u,b as H,N,j as f,eK as j}from"./index-B_BHgQQY.js";import{D as z}from"./DialogTitle-BL-ZXwRQ.js";import{a as W}from"./DialogContent-BLGJ1kXP.js";import{D as F}from"./DialogContentText-X3gecpnz.js";import{A as G}from"./Alert-af15MLjr.js";import{D as q}from"./DialogActions-B4c7iV3e.js";import{B as X}from"./Button-4ORflwU5.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21",key:"9csbqa"}],["path",{d:"m14 19.5 3-3 3 3",key:"9vmjn0"}],["path",{d:"M17 22v-5.5",key:"1aa6fl"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],pt=U("image-up",Q);var V=Object.defineProperty,J=(h,t,e)=>t in h?V(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e,m=(h,t,e)=>J(h,typeof t!="symbol"?t+"":t,e);const O={x:0,y:0,width:0,height:0,unit:"px"},E=(h,t,e)=>Math.min(Math.max(h,t),e),Z=(...h)=>h.filter(t=>t&&typeof t=="string").join(" "),P=(h,t)=>h===t||h.width===t.width&&h.height===t.height&&h.x===t.x&&h.y===t.y&&h.unit===t.unit;function tt(h,t,e,o){const i=v(h,e,o);return h.width&&(i.height=i.width/t),h.height&&(i.width=i.height*t),i.y+i.height>o&&(i.height=o-i.y,i.width=i.height*t),i.x+i.width>e&&(i.width=e-i.x,i.height=i.width/t),h.unit==="%"?R(i,e,o):i}function et(h,t,e){const o=v(h,t,e);return o.x=(t-o.width)/2,o.y=(e-o.height)/2,h.unit==="%"?R(o,t,e):o}function R(h,t,e){return h.unit==="%"?{...O,...h,unit:"%"}:{unit:"%",x:h.x?h.x/t*100:0,y:h.y?h.y/e*100:0,width:h.width?h.width/t*100:0,height:h.height?h.height/e*100:0}}function v(h,t,e){return h.unit?h.unit==="px"?{...O,...h,unit:"px"}:{unit:"px",x:h.x?h.x*t/100:0,y:h.y?h.y*e/100:0,width:h.width?h.width*t/100:0,height:h.height?h.height*e/100:0}:{...O,...h,unit:"px"}}function S(h,t,e,o,i,n=0,s=0,l=o,a=i){const r={...h};let c=Math.min(n,o),g=Math.min(s,i),p=Math.min(l,o),d=Math.min(a,i);t&&(t>1?(c=s?s*t:c,g=c/t,p=l*t):(g=n?n/t:g,c=g*t,d=a/t)),r.y<0&&(r.height=Math.max(r.height+r.y,g),r.y=0),r.x<0&&(r.width=Math.max(r.width+r.x,c),r.x=0);const w=o-(r.x+r.width);w<0&&(r.x=Math.min(r.x,o-c),r.width+=w);const x=i-(r.y+r.height);if(x<0&&(r.y=Math.min(r.y,i-g),r.height+=x),r.width<c&&((e==="sw"||e=="nw")&&(r.x-=c-r.width),r.width=c),r.height<g&&((e==="nw"||e=="ne")&&(r.y-=g-r.height),r.height=g),r.width>p&&((e==="sw"||e=="nw")&&(r.x-=p-r.width),r.width=p),r.height>d&&((e==="nw"||e=="ne")&&(r.y-=d-r.height),r.height=d),t){const y=r.width/r.height;if(y<t){const C=Math.max(r.width/t,g);(e==="nw"||e=="ne")&&(r.y-=C-r.height),r.height=C}else if(y>t){const C=Math.max(r.height*t,c);(e==="sw"||e=="nw")&&(r.x-=C-r.width),r.width=C}}return r}function it(h,t,e,o){const i={...h};return t==="ArrowLeft"?o==="nw"?(i.x-=e,i.y-=e,i.width+=e,i.height+=e):o==="w"?(i.x-=e,i.width+=e):o==="sw"?(i.x-=e,i.width+=e,i.height+=e):o==="ne"?(i.y+=e,i.width-=e,i.height-=e):o==="e"?i.width-=e:o==="se"&&(i.width-=e,i.height-=e):t==="ArrowRight"&&(o==="nw"?(i.x+=e,i.y+=e,i.width-=e,i.height-=e):o==="w"?(i.x+=e,i.width-=e):o==="sw"?(i.x+=e,i.width-=e,i.height-=e):o==="ne"?(i.y-=e,i.width+=e,i.height+=e):o==="e"?i.width+=e:o==="se"&&(i.width+=e,i.height+=e)),t==="ArrowUp"?o==="nw"?(i.x-=e,i.y-=e,i.width+=e,i.height+=e):o==="n"?(i.y-=e,i.height+=e):o==="ne"?(i.y-=e,i.width+=e,i.height+=e):o==="sw"?(i.x+=e,i.width-=e,i.height-=e):o==="s"?i.height-=e:o==="se"&&(i.width-=e,i.height-=e):t==="ArrowDown"&&(o==="nw"?(i.x+=e,i.y+=e,i.width-=e,i.height-=e):o==="n"?(i.y+=e,i.height-=e):o==="ne"?(i.y+=e,i.width-=e,i.height-=e):o==="sw"?(i.x-=e,i.width+=e,i.height+=e):o==="s"?i.height+=e:o==="se"&&(i.width+=e,i.height+=e)),i}const _={capture:!0,passive:!1};let nt=0;const b=class D extends M.PureComponent{constructor(){super(...arguments),m(this,"docMoveBound",!1),m(this,"mouseDownOnCrop",!1),m(this,"dragStarted",!1),m(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),m(this,"componentRef",M.createRef()),m(this,"mediaRef",M.createRef()),m(this,"resizeObserver"),m(this,"initChangeCalled",!1),m(this,"instanceId",`rc-${nt++}`),m(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),m(this,"onCropPointerDown",t=>{const{crop:e,disabled:o}=this.props,i=this.getBox();if(!e)return;const n=v(e,i.width,i.height);if(o)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const s=t.target.dataset.ord,l=!!s;let a=t.clientX,r=t.clientY,c=n.x,g=n.y;if(s){const p=t.clientX-i.x,d=t.clientY-i.y;let w=0,x=0;s==="ne"||s=="e"?(w=p-(n.x+n.width),x=d-n.y,c=n.x,g=n.y+n.height):s==="se"||s==="s"?(w=p-(n.x+n.width),x=d-(n.y+n.height),c=n.x,g=n.y):s==="sw"||s=="w"?(w=p-n.x,x=d-(n.y+n.height),c=n.x+n.width,g=n.y):(s==="nw"||s=="n")&&(w=p-n.x,x=d-n.y,c=n.x+n.width,g=n.y+n.height),a=c+i.x+w,r=g+i.y+x}this.evData={startClientX:a,startClientY:r,startCropX:c,startCropY:g,clientX:t.clientX,clientY:t.clientY,isResize:l,ord:s},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),m(this,"onComponentPointerDown",t=>{const{crop:e,disabled:o,locked:i,keepSelection:n,onChange:s}=this.props,l=this.getBox();if(o||i||n&&e)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=t.clientX-l.x,r=t.clientY-l.y,c={unit:"px",x:a,y:r,width:0,height:0};this.evData={startClientX:t.clientX,startClientY:t.clientY,startCropX:a,startCropY:r,clientX:t.clientX,clientY:t.clientY,isResize:!0},this.mouseDownOnCrop=!0,s(v(c,l.width,l.height),R(c,l.width,l.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),m(this,"onDocPointerMove",t=>{const{crop:e,disabled:o,onChange:i,onDragStart:n}=this.props,s=this.getBox();if(o||!e||!this.mouseDownOnCrop)return;t.cancelable&&t.preventDefault(),this.dragStarted||(this.dragStarted=!0,n&&n(t));const{evData:l}=this;l.clientX=t.clientX,l.clientY=t.clientY;let a;l.isResize?a=this.resizeCrop():a=this.dragCrop(),P(e,a)||i(v(a,s.width,s.height),R(a,s.width,s.height))}),m(this,"onComponentKeyDown",t=>{const{crop:e,disabled:o,onChange:i,onComplete:n}=this.props;if(o)return;const s=t.key;let l=!1;if(!e)return;const a=this.getBox(),r=this.makePixelCrop(a),c=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?D.nudgeStepLarge:t.shiftKey?D.nudgeStepMedium:D.nudgeStep;if(s==="ArrowLeft"?(r.x-=c,l=!0):s==="ArrowRight"?(r.x+=c,l=!0):s==="ArrowUp"?(r.y-=c,l=!0):s==="ArrowDown"&&(r.y+=c,l=!0),l){t.cancelable&&t.preventDefault(),r.x=E(r.x,0,a.width-r.width),r.y=E(r.y,0,a.height-r.height);const g=v(r,a.width,a.height),p=R(r,a.width,a.height);i(g,p),n&&n(g,p)}}),m(this,"onHandlerKeyDown",(t,e)=>{const{aspect:o=0,crop:i,disabled:n,minWidth:s=0,minHeight:l=0,maxWidth:a,maxHeight:r,onChange:c,onComplete:g}=this.props,p=this.getBox();if(n||!i)return;if(t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight")t.stopPropagation(),t.preventDefault();else return;const d=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?D.nudgeStepLarge:t.shiftKey?D.nudgeStepMedium:D.nudgeStep,w=v(i,p.width,p.height),x=it(w,t.key,d,e),y=S(x,o,e,p.width,p.height,s,l,a,r);if(!P(i,y)){const C=R(y,p.width,p.height);c(y,C),g&&g(y,C)}}),m(this,"onDocPointerDone",t=>{const{crop:e,disabled:o,onComplete:i,onDragEnd:n}=this.props,s=this.getBox();this.unbindDocMove(),!(o||!e)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,n&&n(t),i&&i(v(e,s.width,s.height),R(e,s.width,s.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),m(this,"onDragFocus",()=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)})}get document(){return document}getBox(){const t=this.mediaRef.current;if(!t)return{x:0,y:0,width:0,height:0};const{x:e,y:o,width:i,height:n}=t.getBoundingClientRect();return{x:e,y:o,width:i,height:n}}componentDidUpdate(t){const{crop:e,onComplete:o}=this.props;if(o&&!t.crop&&e){const{width:i,height:n}=this.getBox();i&&n&&o(v(e,i,n),R(e,i,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,_),this.document.addEventListener("pointerup",this.onDocPointerDone,_),this.document.addEventListener("pointercancel",this.onDocPointerDone,_),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,_),this.document.removeEventListener("pointerup",this.onDocPointerDone,_),this.document.removeEventListener("pointercancel",this.onDocPointerDone,_),this.docMoveBound=!1)}getCropStyle(){const{crop:t}=this.props;if(t)return{top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`}}dragCrop(){const{evData:t}=this,e=this.getBox(),o=this.makePixelCrop(e),i=t.clientX-t.startClientX,n=t.clientY-t.startClientY;return o.x=E(t.startCropX+i,0,e.width-o.width),o.y=E(t.startCropY+n,0,e.height-o.height),o}getPointRegion(t,e,o,i){const{evData:n}=this,s=n.clientX-t.x,l=n.clientY-t.y;let a;i&&e?a=e==="nw"||e==="n"||e==="ne":a=l<n.startCropY;let r;return o&&e?r=e==="nw"||e==="w"||e==="sw":r=s<n.startCropX,r?a?"nw":"sw":a?"ne":"se"}resolveMinDimensions(t,e,o=0,i=0){const n=Math.min(o,t.width),s=Math.min(i,t.height);return!e||!n&&!s?[n,s]:e>1?n?[n,n/e]:[s*e,s]:s?[s*e,s]:[n,n/e]}resizeCrop(){const{evData:t}=this,{aspect:e=0,maxWidth:o,maxHeight:i}=this.props,n=this.getBox(),[s,l]=this.resolveMinDimensions(n,e,this.props.minWidth,this.props.minHeight);let a=this.makePixelCrop(n);const r=this.getPointRegion(n,t.ord,s,l),c=t.ord||r;let g=t.clientX-t.startClientX,p=t.clientY-t.startClientY;(s&&c==="nw"||c==="w"||c==="sw")&&(g=Math.min(g,-s)),(l&&c==="nw"||c==="n"||c==="ne")&&(p=Math.min(p,-l));const d={unit:"px",x:0,y:0,width:0,height:0};r==="ne"?(d.x=t.startCropX,d.width=g,e?(d.height=d.width/e,d.y=t.startCropY-d.height):(d.height=Math.abs(p),d.y=t.startCropY-d.height)):r==="se"?(d.x=t.startCropX,d.y=t.startCropY,d.width=g,e?d.height=d.width/e:d.height=p):r==="sw"?(d.x=t.startCropX+g,d.y=t.startCropY,d.width=Math.abs(g),e?d.height=d.width/e:d.height=p):r==="nw"&&(d.x=t.startCropX+g,d.width=Math.abs(g),e?(d.height=d.width/e,d.y=t.startCropY-d.height):(d.height=Math.abs(p),d.y=t.startCropY+p));const w=S(d,e,r,n.width,n.height,s,l,o,i);return e||D.xyOrds.indexOf(c)>-1?a=w:D.xOrds.indexOf(c)>-1?(a.x=w.x,a.width=w.width):D.yOrds.indexOf(c)>-1&&(a.y=w.y,a.height=w.height),a.x=E(a.x,0,n.width-a.width),a.y=E(a.y,0,n.height-a.height),a}renderCropSelection(){const{ariaLabels:t=D.defaultProps.ariaLabels,disabled:e,locked:o,renderSelectionAddon:i,ruleOfThirds:n,crop:s}=this.props,l=this.getCropStyle();if(s)return u.createElement("div",{style:l,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!e&&!o&&u.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},u.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),u.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),u.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),u.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"nw"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"n"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"ne"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"e"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"se"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"s"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"sw"),role:"button"}),u.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"w"),role:"button"})),i&&u.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:a=>a.stopPropagation()},i(this.state)),n&&u.createElement(u.Fragment,null,u.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),u.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(t){const e={...O,...this.props.crop||{}};return v(e,t.width,t.height)}render(){const{aspect:t,children:e,circularCrop:o,className:i,crop:n,disabled:s,locked:l,style:a,ruleOfThirds:r}=this.props,{cropIsActive:c,newCropIsBeingDrawn:g}=this.state,p=n?this.renderCropSelection():null,d=Z("ReactCrop",i,c&&"ReactCrop--active",s&&"ReactCrop--disabled",l&&"ReactCrop--locked",g&&"ReactCrop--new-crop",n&&t&&"ReactCrop--fixed-aspect",n&&o&&"ReactCrop--circular-crop",n&&r&&"ReactCrop--rule-of-thirds",!this.dragStarted&&n&&!n.width&&!n.height&&"ReactCrop--invisible-crop",o&&"ReactCrop--no-animate");return u.createElement("div",{ref:this.componentRef,className:d,style:a},u.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},e),n?u.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},u.createElement("defs",null,u.createElement("mask",{id:`hole-${this.instanceId}`},u.createElement("rect",{width:"100%",height:"100%",fill:"white"}),o?u.createElement("ellipse",{cx:`${n.x+n.width/2}${n.unit}`,cy:`${n.y+n.height/2}${n.unit}`,rx:`${n.width/2}${n.unit}`,ry:`${n.height/2}${n.unit}`,fill:"black"}):u.createElement("rect",{x:`${n.x}${n.unit}`,y:`${n.y}${n.unit}`,width:`${n.width}${n.unit}`,height:`${n.height}${n.unit}`,fill:"black"}))),u.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,p)}};m(b,"xOrds",["e","w"]),m(b,"yOrds",["n","s"]),m(b,"xyOrds",["nw","ne","se","sw"]),m(b,"nudgeStep",1),m(b,"nudgeStepMedium",10),m(b,"nudgeStepLarge",100),m(b,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let rt=b;const T=1,ot="crop-modal-title";function at(h,t,e){return et(tt({unit:"%",width:100},e,h,t),h,t)}const ut=({onConfirm:h,onClose:t,src:e})=>{const[o,i]=M.useState(),[n,s]=M.useState(),[l,a]=M.useState(!1),r=M.useRef(null),{t:c}=H(N.Account),{t:g}=H(N.Common),p=async()=>{const w=r.current;if(!w||!n)throw a(!0),new Error("Crop canvas does not exist, this should never happen");const x=new OffscreenCanvas(n.width,n.height),y=x.getContext("2d");if(!y)throw new Error("No 2d context");const C={width:n.width/w.width,height:n.height/w.height},A=w.naturalWidth/w.width,I=Math.floor(C.width*w.naturalWidth),k=Math.floor(C.height*w.naturalHeight);x.width=I,x.height=k,y.imageSmoothingQuality="high";const L=n.x*A,Y=n.y*A,B=w.naturalWidth*C.width,$=w.naturalHeight*C.height;y.drawImage(w,L,Y,B,$,0,0,I,k);const K=await x.convertToBlob({type:"image/webp",quality:.8});h(K)},d=w=>{r.current||(r.current=w.currentTarget);const{width:x,height:y}=w.currentTarget;i(at(x,y,T))};return f.jsxs(f.Fragment,{children:[f.jsx(z,{id:ot,children:c("CROP_IMAGE_MODAL_TITLE")}),f.jsxs(W,{sx:{textAlign:"center"},children:[f.jsx(F,{children:c("CROP_IMAGE_MODAL_CONTENT_TEXT")}),f.jsx(rt,{crop:o,onChange:(w,x)=>i(x),onComplete:w=>s(w),aspect:T,ruleOfThirds:!0,children:f.jsx("img",{ref:r,alt:c("CROP_IMAGE_MODAL_IMAGE_ALT_TEXT"),width:"100%",height:"100%",src:e,onLoad:d})}),l&&f.jsx(G,{severity:"error",children:c("CROP_IMAGE_MODAL_UNEXPECTED_ERROR")})]}),f.jsxs(q,{children:[f.jsx(X,{onClick:t,variant:"text",children:g("CANCEL.BUTTON_TEXT")}),f.jsx(X,{onClick:p,disabled:l,id:j,children:g("CONFIRM.BUTTON_TEXT")})]})]})};export{ut as C,pt as I,ot as M};
