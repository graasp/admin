import{j as t,S as k,T as g,b as T,N as I,ba as w,bb as B,r as S,bc as _,bd as v,d as N,h as R,be as C,bf as D,$ as P}from"./index-B_BHgQQY.js";import{L as j}from"./List-Cf8ruq7c.js";import{S as M}from"./Skeleton-Bf_dEhrE.js";import{I as O}from"./ItemIcon-aRVTEBTL.js";import{I as U}from"./IconButton-t5WdCoTE.js";import{B as F}from"./ButtonLink-D-yZd9SS.js";import{g as E}from"./mimeTypes-Bpmm_hmI.js";import{E as V}from"./errorboundary-DQhN36hL.js";import{L as W}from"./ListItemButton-TRjTb-Ya.js";import{C as H}from"./Collapse-CF3-lsEC.js";import{c as G,s as X}from"./shuffle-_LX9pwJ9.js";import{A as z}from"./Alert-af15MLjr.js";const K=({id:e,children:i,fullHeight:s})=>t.jsx(j,{id:e,sx:{height:s?"100%":void 0},children:i});function y(){return t.jsx(k,{p:1,children:["elem 1","elem 2","elem 3","elem 4","elem 5"].map(e=>t.jsx(g,{children:t.jsx(M,{variant:"text"})},e))})}function Z({element:e,level:i,isExpanded:s,toggleExpand:r}){const o=n=>{n.stopPropagation(),r(e.id)};return t.jsxs(t.Fragment,{children:[i===0&&e.metadata?.type&&t.jsx(O,{size:"17px",alt:"icon",type:e.metadata.type,mimetype:e.metadata.mimetype}),i>0&&t.jsx(U,{onClick:o,sx:{p:0,"&:hover":{opacity:.6}},children:s?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#5050d2",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"})}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#5050d2",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"})})})]})}function $(){const{t:e}=T(I.Player);return t.jsx(F,{id:w,to:window.location.toString(),children:e("TREE_NAVIGATION_RELOAD_TEXT")})}const q=e=>e.reduce((i,s)=>{const r=B(s.path);return r&&(i[r]=(i[r]??[]).concat([s])),i},{}),J=(e,i)=>{const s={};e.length===1&&(s[e[0].id]={id:e[0].id,name:e[0].name,metadata:{type:e[0].type,mimetype:E(e[0].extra)},children:[]});const r=q(e),o=n=>{if(n.type==="folder"&&r[n.id]){const a=r[n.id]??[];return{id:n.id,name:n.name,metadata:{type:n.type},children:a.map(c=>o(c))}}return{id:n.id,name:n.name,metadata:{type:n.type,mimetype:E(n.extra)}}};return i.forEach(n=>{s[n.id]=o(n)}),s},pe=["folder","shortcut"];function b({expandedIds:e,selectedIds:i,item:s,toggleExpand:r,level:o=0,onClick:n}){const a=e.includes(s.id),l=i.includes(s.id);return t.jsxs(t.Fragment,{children:[t.jsxs(W,{className:v(s.id),selected:l,sx:{ml:3*o,gap:1,py:0,fontWeight:l||o===0?"bold":"normal"},onClick:()=>{n?.(s.id),a||r(s.id)},children:[!!s.children?.length&&t.jsx(Z,{element:s,level:o,isExpanded:a,toggleExpand:r}),s.name]}),t.jsx(H,{in:a,timeout:"auto",children:t.jsx(j,{component:"div",disablePadding:!0,children:s.children?.map(c=>t.jsx(b,{toggleExpand:r,selectedIds:i,expandedIds:e,item:c,level:o+1,onClick:n},c.id))})})]})}function Q({id:e,header:i,items:s,rootItems:r,onTreeItemSelect:o,allowedTypes:n=[],itemId:a}){const l=s?.filter(d=>n.length?n.includes(d.type):!0),[c,h]=S.useState(()=>{const d=l?.find(p=>p.id===a),m=r[0]?.id?[r[0].id]:[];return d?_(d.path):m}),u=J(l??[],r),x=Object.values(u),f=d=>{h(m=>m.includes(d)?m.filter(p=>p!==d):[...m,d])};return t.jsxs(V,{fallback:t.jsx($,{}),children:[i&&t.jsx(g,{sx:{ml:2,fontWeight:"bold"},variant:"body1",children:i}),t.jsx(j,{id:e,dense:!0,component:"nav",children:t.jsx(b,{item:x[0],selectedIds:a?[a]:[],expandedIds:c,toggleExpand:f,onClick:o})})]})}const{useItem:Y,useDescendants:ee}=R,he=({rootId:e,itemId:i,shuffle:s=!1,types:r,showHidden:o=!1,handleNavigationOnClick:n})=>{const{user:a}=N(),{t:l}=T(I.Common),{data:c,isLoading:h}=ee({id:e??"",types:r,showHidden:o}),{data:u,isLoading:x,isError:f,error:d}=Y(e);let m=[...c||[]];if(s){const p=e??"",L=a?.id??"",A=G(p,L);m=X(m,A)}if(u){if(c)return t.jsx(K,{id:C,children:t.jsx(Q,{id:D,rootItems:[u],items:[u,...m],onTreeItemSelect:n,itemId:i,allowedTypes:r},e)});if(h)return t.jsx(y,{})}return x?t.jsx(y,{}):f?P(d)&&d.response?.status===403?null:t.jsx(z,{severity:"error",children:l("ERRORS.UNEXPECTED")}):null};export{pe as G,he as I,y as L};
