import{ed as m,ee as h,ef as v,eg as _,eh as I,ei as u,ej as k,ek as y,el as g,em as S,r as p}from"./index-B_BHgQQY.js";function E(s={}){const t=u.document,n=t?.head||t?.body;if(!n){m&&h.error("[showReportDialog] Global document not defined");return}const e=v(),a=_()?.getDsn();if(!a){m&&h.error("[showReportDialog] DSN not configured");return}const c={...s,user:{...e.getUser(),...s.user},eventId:s.eventId||I()},r=u.document.createElement("script");r.async=!0,r.crossOrigin="anonymous",r.src=k(a,c);const{onLoad:l,onClose:d}=c;if(l&&(r.onload=l),d){const i=D=>{if(D.data==="__sentry_reportdialog_closed__")try{d()}finally{u.removeEventListener("message",i)}};u.addEventListener("message",i)}n.appendChild(r)}function R(s){const t=s.match(/^([^.]+)/);return t!==null&&parseInt(t[0])>=17}function B(s,t){const n=new WeakSet;function e(o,a){if(!n.has(o)){if(o.cause)return n.add(o),e(o.cause,a);o.cause=a}}e(s,t)}function b(s,{componentStack:t},n){if(R(p.version)&&y(s)&&t){const e=new Error(s.message);e.name=`React ErrorBoundary ${s.name}`,e.stack=t,B(s,e)}return g(e=>(e.setContext("react",{componentStack:t}),S(s,n)))}const C=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,f={componentStack:null,error:null,eventId:null};class U extends p.Component{constructor(t){super(t),this.state=f,this._openFallbackReportDialog=!0;const n=_();n&&t.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=n.on("afterSendEvent",e=>{!e.type&&this._lastEventId&&e.event_id===this._lastEventId&&E({...t.dialogOptions,eventId:this._lastEventId})}))}componentDidCatch(t,n){const{componentStack:e}=n,{beforeCapture:o,onError:a,showDialog:c,dialogOptions:r}=this.props;g(l=>{o&&o(l,t,e);const d=this.props.handled!=null?this.props.handled:!!this.props.fallback,i=b(t,n,{mechanism:{handled:d}});a&&a(t,e,i),c&&(this._lastEventId=i,this._openFallbackReportDialog&&E({...r,eventId:i})),this.setState({error:t,componentStack:e,eventId:i})})}componentDidMount(){const{onMount:t}=this.props;t&&t()}componentWillUnmount(){const{error:t,componentStack:n,eventId:e}=this.state,{onUnmount:o}=this.props;o&&(this.state===f?o(null,null,null):o(t,n,e)),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}resetErrorBoundary(){const{onReset:t}=this.props,{error:n,componentStack:e,eventId:o}=this.state;t&&t(n,e,o),this.setState(f)}render(){const{fallback:t,children:n}=this.props,e=this.state;if(e.componentStack===null)return typeof n=="function"?n():n;const o=typeof t=="function"?p.createElement(t,{error:e.error,componentStack:e.componentStack,resetError:()=>this.resetErrorBoundary(),eventId:e.eventId}):t;return p.isValidElement(o)?o:(t&&C&&h.warn("fallback did not produce a valid ReactElement"),null)}}export{U as E};
